#!/usr/bin/python
__author__ = 'Shivam'
import ftplib
import os
def anonyScan():
    host = raw_input('Enter the Host Adress : ')
    try:
        ftp = ftplib.FTP(host)
        ftp.login('anonymous','abc@123.com')
        print '[+] Anonymous Login Successful '

    except :
        print '[-] No Anonymous Login Allowed on Server'


def bruteforcer():
    host = raw_input('Enter the Host Adress: ')
    psswdfile = raw_input('Enter the name of Password File (in format username:password): ')
    pf = open(psswdfile, 'r')
    for line in pf.readlines():
        uname = line.split(':')[0]
        psswd = line.split(':')[1].strip('\r').strip('\n')
        print '[+] Trying ' + uname + ' ' + psswd
        try:
            ftp = ftplib.FTP(host)
            ftp.login(uname,psswd)
            print '[+] SuccessFully Loged in with ' +uname + ':' + psswd
            ftp.quit()
            break
        except:
            pass

    choice = raw_input('[?] Proceed to Directory Traversal (y/n) ? :')
    if choice == 'y':
        direct_traver(uname , psswd)



def direct_traver(uname , psswd):
    host = raw_input('Enter the host adress: ')
    try:
        ftp = ftplib.FTP(host)
        ftp.login(uname,psswd)
        dirlist = ftp.nlst()
        ftp.quit()
    except:
        dirlist = []
        print '[-] Could not list directory contents '
        exit(1)

    retlist = []
    for filename in dirlist:
        fn = filename.lower()
        if '.php' in fn or '.htm' in fn or '.asp' in fn:
            print '[+] Found Default Page: '+ filename
            retlist.append(filename)
    total = 0
    for file in retlist:
        print file
        total +=1
    print 'Total Files : ' + total


def main():
    print '''**************************************************************
             Welcome to FTP Modules of Python Vulnerability Assesment
                                            by Shivam Mehta
            **************************************************************'''

    print '''1.) Try for Anonymous Login
             2.) Bruteforce
             3.) Traverse Directoy'''
    choice = input('[?] Enter your choice :')
    if choice == 1:
        anonyScan()
    elif choice == 2:
        bruteforcer()
    elif choice == 3:
        uname =raw_input('[?] Enter the Username : ')
        psswd = raw_input('[?] Enter the Password: ')
        direct_traver(uname,psswd)
    else:
        print '[-] Invalid Input Please see the menu carefully!'



if __name__ == '__main__':
    main()
    inp = raw_input("Try Again ? (y/n) ")
    while inp == 'y':
        main()

